## 仓库 Repositories 

仓库用于在统一语言中表达对聚合体的查询。

对于仅用于查询的可遍历关联，其数量的激增会使模型变得混乱。在成熟的模型中，查询通常表达领域概念。然而，查询也会带来问题。

数据访问基础设施所带来的纯粹的技术复杂性，很快就会淹没客户端代码，导致开发人员将领域层简单化，从而使模型失去价值。

查询框架可以封装多数技术复杂性，使开发人员以更自动化或声明式的方法从数据库中获取数据，但这只能解决部分问题。

不受约束的查询可能会从对象中提取零散的字段，从而破坏封装，或者从聚合体内部实例化对象，从而绕过聚合体根，导致无法确保这些对象满足领域规则。领域逻辑被移到查询和应用层代码中，而实体和值对象则成了纯粹的数据容器。


因此： 

**为每个需要全局访问的聚合体类型创建一个服务。通过该服务，可以假想存在一个保存在内存中的，该类型的所有聚合根对象组成的集合。这个集合可以通过一个公共的全局接口进行访问。这个接口提供了添加和删除对象的方法，从而封装了向数据存储中实际插入或删除数据的逻辑。这个接口也提供了基于领域专家所理解的查询条件来查找对象的方法。这些方法返回符合查询条件的，完全实例化了的对象或对象集合，从而封装了实际的存储和查询技术。另一种方式是返回一个代理对象，可以把这个代理对象假象成完全实例化了的聚合体，其背后则是以懒加载的方式实现的。只为确实需要直接访问的聚合根提供仓库。将应用逻辑聚焦在模型上，将所有对象存储和访问逻辑委托给仓库。**